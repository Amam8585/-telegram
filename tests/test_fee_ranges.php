<?php
require __DIR__.'/../config.php';
require __DIR__.'/../txt.php';
require __DIR__.'/../helpers.php';

$normal = [
    50000=>20000, 400000=>30000, 900000=>40000, 1500000=>50000,
    2000000=>70000, 2500000=>80000, 3000000=>100000, 3500000=>110000,
    4000000=>130000, 4500000=>140000, 5000000=>150000, 5500000=>160000,
    6000000=>180000, 6500000=>200000, 7000000=>230000, 7500000=>250000,
    8000000=>290000, 8500000=>310000, 9000000=>360000, 10000000=>460000,
    11000000=>610000, 12000000=>710000, 13000000=>910000, 14000000=>1010000,
];
$economic = [
    50000=>15000, 400000=>20000, 900000=>25000, 1500000=>30000,
    2000000=>45000, 2500000=>60000, 3000000=>70000, 3500000=>80000,
    4000000=>90000, 4500000=>110000, 5000000=>120000, 5500000=>140000,
    6000000=>160000, 6500000=>185000, 7000000=>200000, 7500000=>235000,
    8000000=>265000, 8500000=>290000, 9000000=>345000, 10000000=>400000,
    11000000=>550000, 12000000=>650000, 13000000=>750000, 14000000=>850000,
];

$errors = [];
if (compute_fee(49999, 'normal') !== 0) $errors[] = 'normal below min';
if (compute_fee(49999, 'economic') !== 0) $errors[] = 'economic below min';

foreach ($normal as $amount=>$expected) {
    $got = compute_fee($amount, 'normal');
    if ($got !== $expected) $errors[] = "normal $amount => $got (expected $expected)";
}
foreach ($economic as $amount=>$expected) {
    $got = compute_fee($amount, 'economic');
    if ($got !== $expected) $errors[] = "economic $amount => $got (expected $expected)";
}

if ($errors) {
    echo "FAIL\n".implode("\n", $errors)."\n";
    exit(1);
}

echo "OK\n";
